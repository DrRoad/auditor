<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction into model audit • auditor</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top navbar-mi2" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-mi2logo" href="http://mi2.mini.pw.edu.pl/">
        <img src="https://github.com/mi2-warsaw/MI2template/blob/master/inst/pkgdown/assets/MI2logo.jpg?raw=true" alt="MI2" height="46" title="MI2"></a>
      <a class="navbar-brand navbar-mi2" href="../index.html">auditor</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="navbar-mi2 nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/HalfNormal.html">The half-normal plots</a>
    </li>
    <li>
      <a href="../articles/Intorduction_into_model_audit.html">Introduction into model audit</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Introduction into model audit</h1>
                        <h4 class="author">Alicja Gosiewska</h4>
            
            <h4 class="date">2018-03-11</h4>
          </div>

    
    
<div class="contents">
<p>This vignette demonstrates how to use the auditor package. auditor provides methods for model verification and validation by error analysis.</p>
<p>Many models, such as random forests and neutral networks are nowadays treated as black boxes. Therefore, there is a lack of theory that describes the behavior of errors in those models.</p>
<p>Most methods provided in auditor pacage are model-agnostic, so can be used regardless of knowledge about errors.</p>
<p>Some of the graphical error analysis methods also have corresponding SCORES, which allow comparison of two models.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">123</span>)</code></pre></div>
<div id="boston-data" class="section level1">
<h1 class="hasAnchor">
<a href="#boston-data" class="anchor"></a>Boston data</h1>
<p>I our example we will use the Boston dataset from package MASS. It contains information about housing in the area of Boston.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(Boston, <span class="dt">package =</span> <span class="st">"MASS"</span>)
Boston<span class="op">$</span>chas &lt;-<span class="st"> </span><span class="kw">as.logical</span>(Boston<span class="op">$</span>chas)
<span class="kw">head</span>(Boston)</code></pre></div>
<pre><code>##      crim zn indus  chas   nox    rm  age    dis rad tax ptratio  black
## 1 0.00632 18  2.31 FALSE 0.538 6.575 65.2 4.0900   1 296    15.3 396.90
## 2 0.02731  0  7.07 FALSE 0.469 6.421 78.9 4.9671   2 242    17.8 396.90
## 3 0.02729  0  7.07 FALSE 0.469 7.185 61.1 4.9671   2 242    17.8 392.83
## 4 0.03237  0  2.18 FALSE 0.458 6.998 45.8 6.0622   3 222    18.7 394.63
## 5 0.06905  0  2.18 FALSE 0.458 7.147 54.2 6.0622   3 222    18.7 396.90
## 6 0.02985  0  2.18 FALSE 0.458 6.430 58.7 6.0622   3 222    18.7 394.12
##   lstat medv
## 1  4.98 24.0
## 2  9.14 21.6
## 3  4.03 34.7
## 4  2.94 33.4
## 5  5.33 36.2
## 6  5.21 28.7</code></pre>
</div>
<div id="random-forest-model" class="section level1">
<h1 class="hasAnchor">
<a href="#random-forest-model" class="anchor"></a>Random forest model</h1>
<p>We need to fit model. For example a Random Forest model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">"randomForest"</span>)
Boston_rf_model &lt;-<span class="st"> </span><span class="kw">randomForest</span>(medv <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> Boston, <span class="dt">ntree=</span><span class="dv">50</span>)</code></pre></div>
</div>
<div id="preparation-for-error-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#preparation-for-error-analysis" class="anchor"></a>Preparation for error analysis</h1>
<p>The beginning of each analysis is creation of a modelAudit object. It’s an object that can be used to audit a model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">"auditor"</span>)
Boston_rf_audit &lt;-<span class="st"> </span><span class="kw"><a href="../reference/audit.html">audit</a></span>(Boston_rf_model)</code></pre></div>
</div>
<div id="error-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#error-analysis" class="anchor"></a>Error analysis</h1>
<p>In this section we give short overview of a visual validation of model errors and show the propositions for the validation scores.</p>
<div id="plotting-residuals" class="section level2">
<h2 class="hasAnchor">
<a href="#plotting-residuals" class="anchor"></a>Plotting residuals</h2>
<p>Function <code>plot()</code> used on modelAudit object returns a <strong>Residuals vs fitted values plot</strong>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(Boston_rf_audit)</code></pre></div>
<p><img src="Intorduction_into_model_audit_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
<p>Residuals may be ordered by values any model variable.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(Boston_rf_audit, <span class="dt">variable =</span> <span class="st">"medv"</span>)</code></pre></div>
<p><img src="Intorduction_into_model_audit_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
<p>In the following sections we will show how to use the <code>plot()</code> function to generate another diagnostic plots.</p>
</div>
<div id="autocorrelation" class="section level2">
<h2 class="hasAnchor">
<a href="#autocorrelation" class="anchor"></a>Autocorrelation</h2>
<p>On the Autocorrelation plot there are i-th vs i+1-th residuals. This plot may be useful for checking autocorrelation of residuals.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(Boston_rf_audit, <span class="dt">type=</span><span class="st">"Autocorrelation"</span>, <span class="dt">variable=</span><span class="st">"crim"</span>)</code></pre></div>
<p><img src="Intorduction_into_model_audit_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<p>Sometimes it is difficult to compare two models basing only on visualizations. Therefore, we have proposed some scores, which may be useful for choosing a betetr model. DW score and Runs score are based on Durbin-Watson and Runs test statistics. Details and interpretation of scores are described in <code><a href="../reference/scoreDW.html">scoreDW()</a></code> and <code><a href="../reference/scoreRuns.html">scoreRuns()</a></code> functions.</p>
<p>Scores can be calculated with the <code><a href="../reference/scoreDW.html">scoreDW()</a></code> and <code><a href="../reference/scoreRuns.html">scoreRuns()</a></code> functions and the <code><a href="../reference/score.html">score()</a></code> function with argument <code>score</code> equals to “DW” or “Runs”.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/score.html">score</a></span>(Boston_rf_audit, <span class="dt">score=</span><span class="st">"DW"</span>, <span class="dt">variable =</span> <span class="st">"crim"</span>)<span class="op">$</span>score</code></pre></div>
<pre><code>## [1] 2.004283</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/score.html">score</a></span>(Boston_rf_audit, <span class="dt">score=</span><span class="st">"Runs"</span>, <span class="dt">variable =</span> <span class="st">"crim"</span>)<span class="op">$</span>score</code></pre></div>
<pre><code>## [1] 2.289233</code></pre>
</div>
<div id="autocorrelation-function-plot" class="section level2">
<h2 class="hasAnchor">
<a href="#autocorrelation-function-plot" class="anchor"></a>Autocorrelation Function plot</h2>
<p>Autocorrelation Function plot can be used to check randomness of errors. If random, autocorrelations should be near zero for lag separations. If non-random, then autocorrelations will be significantly non-zero.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(Boston_rf_audit, <span class="dt">type=</span><span class="st">"ACF"</span>)</code></pre></div>
<p><img src="Intorduction_into_model_audit_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
</div>
<div id="scale-location" class="section level2">
<h2 class="hasAnchor">
<a href="#scale-location" class="anchor"></a>Scale Location</h2>
<p>This plot shows if residuals are spread equally along the ranges of predictors.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(Boston_rf_audit, <span class="dt">type=</span><span class="st">"ScaleLocation"</span>)</code></pre></div>
<p><img src="Intorduction_into_model_audit_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
<p>For comparing 2 models we can use GQ score, which is based on Goldfeld-Quandt test statistic. This score is computed and described in <code><a href="../reference/scoreGQ.html">scoreGQ()</a></code> function. And may be computed also in <code><a href="../reference/score.html">score()</a></code> function with argument <code>score</code> equals “GQ”.</p>
</div>
<div id="cooks-distances" class="section level2">
<h2 class="hasAnchor">
<a href="#cooks-distances" class="anchor"></a>Cook’s distances</h2>
<p>Cook’s distance is used to estimate of the influence of an single observation. It is a tool for identifying observations that may negatively affect the model.</p>
<p>Data points indicated by Cook’s distances are worth checking for validity. Cook’s distances may be also used for indicating regions of the design space where it would be good to obtain more observations.</p>
<p>Cook’s Distances are calculated by removing the i-th observation from the data and recalculating the model. It shows how much all the values in the model change when the i-th observation is removed.</p>
<p>In the case of models of classes other than <code>lm</code> and <code>glm</code> the distances are computed directly from the definition, so this may take a while. In this example we will compute them for a linear model.</p>
<p>We will use the Prestige dataset from package car.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(Prestige, <span class="dt">package =</span> <span class="st">"car"</span>)
<span class="kw">head</span>(Prestige)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Prestige_lm_model &lt;-<span class="st"> </span><span class="kw">lm</span>(prestige<span class="op">~</span>education <span class="op">+</span><span class="st"> </span>women <span class="op">+</span><span class="st"> </span>income, <span class="dt">data =</span> Prestige)
Prestige_lm_audit &lt;-<span class="st"> </span><span class="kw"><a href="../reference/audit.html">audit</a></span>(Prestige_lm_model)
<span class="kw">plot</span>(Prestige_lm_audit, <span class="dt">type=</span><span class="st">"Cook"</span>)</code></pre></div>
<p><img src="Intorduction_into_model_audit_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
</div>
</div>
<div id="more-methods" class="section level1">
<h1 class="hasAnchor">
<a href="#more-methods" class="anchor"></a>More methods</h1>
<p>Package auditor provides also methods for generating HalfNormal plots with simulated envelopes and computing HalfNormal scores. Further details and use case for this tools are in <a href="https://mi2-warsaw.github.io/auditor/articles/HalfNormal.html">The half-normal plots</a>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#boston-data">Boston data</a></li>
      <li><a href="#random-forest-model">Random forest model</a></li>
      <li><a href="#preparation-for-error-analysis">Preparation for error analysis</a></li>
      <li>
<a href="#error-analysis">Error analysis</a><ul class="nav nav-pills nav-stacked">
<li><a href="#plotting-residuals">Plotting residuals</a></li>
      <li><a href="#autocorrelation">Autocorrelation</a></li>
      <li><a href="#autocorrelation-function-plot">Autocorrelation Function plot</a></li>
      <li><a href="#scale-location">Scale Location</a></li>
      <li><a href="#cooks-distances">Cook’s distances</a></li>
      </ul>
</li>
      <li><a href="#more-methods">More methods</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Alicja Gosiewska, Przemyslaw Biecek.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
